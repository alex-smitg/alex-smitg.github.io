(function(){"use strict";var ne=document.createElement("style");ne.textContent=`html{background:#000}body{position:relative;display:flex;justify-content:center;align-items:center;height:100vh;overflow:clip}.screen{position:relative;display:inline-block}#canvas{display:block}#overlay{position:absolute;pointer-events:none;left:0;top:0;width:100%;height:100%;color:#fff}.bottom_dialog{position:absolute;bottom:0;width:100%;height:20%;background-color:#00158d3d;background-image:none;background-size:auto;background-size:20px 20px;background-image:linear-gradient(to right,#075dff17 2px,#0070ff08 2px),linear-gradient(to bottom,#042bff2e 1px,transparent 1px);border-top:solid 1px #101077;transition:all .6s ease}.gradient{position:absolute;bottom:0%;height:100%;background:linear-gradient(10deg,#000,#2909ca59);width:100%;z-index:1}.text{color:#fff;position:absolute;margin-left:7%;margin-top:5px;text-shadow:1px 1px black;font-size:1.3em;line-height:1.6em;z-index:2;user-select:none}.ch_name{color:#fff;text-transform:capitalize;margin-left:4%;text-shadow:1px 1px black;font-size:1.2em;position:absolute;top:-30px;z-index:2;user-select:none}.progress{height:1px;width:100%;background:#fff}.action{font-size:27px;color:#e5ff00;transition:all .2s ease;width:fit-content}.wavy_char{font-size:40px;text-shadow:2px 2px black}.wavy_text{display:flex;gap:15px;justify-content:center;transform:translateY(70%);height:100%}.battle{pointer-events:all;user-select:none;white-space:pre-line}.action:hover{color:#990202;cursor:pointer}.fade_screen{background:#fff;position:absolute;top:0;left:0;width:100%;height:100%;z-index:1;transition:all 4s ease;opacity:1}.hidden{opacity:0}
/*$vite$:1*/`,document.head.appendChild(ne);const ce=document.getElementById("canvas"),q=document.getElementById("dialog"),le=q.getElementsByClassName("text")[0],de=q.getElementsByClassName("ch_name")[0],F=document.getElementById("overlay"),n=ce.getContext("webgl2"),G=new AudioContext;let me=`#version 300 es
#pragma vscode_glsllint_stage : frag

precision mediump float;

in vec3 normal;
in vec2 textureCoordinates;
in vec3 cameraViewDirection;

uniform sampler2D diffuseTexture;

uniform vec3 dirLightDirection;
uniform vec3 dirLightColor;
uniform float dirLightStrength;

uniform bool lightEnabled;
uniform bool specularEnabled;

out vec4 fragColor;

void main() {
    vec3 color = texture(diffuseTexture, textureCoordinates).rgb;
    
    color *= 0.5; 
    color = pow(color, vec3(1.2));

    float dirLight = dot(normal, dirLightDirection);


    


    float nDot = dot(normal, dirLightDirection);
    vec3 reflectDir = reflect(dirLightDirection, normal);
    float spec = pow(max(dot(cameraViewDirection, -reflectDir), 0.0), 32.0);
    vec3 specular = dirLightColor * spec * nDot * 2.0;

    vec3 result = color;

    if (lightEnabled) {
        result *= dirLightColor * dirLight * dirLightStrength;
    }

    if (specularEnabled) {
        result += specular;
    }
    

    fragColor = vec4(result, 1.0);
}
`,he=`#version 300 es
#pragma vscode_glsllint_stage : vert

in vec3 vertexPosition;
in vec3 vertexNormal;
in vec2 vertexTextureCoordinates;

out vec3 normal;
out vec2 textureCoordinates;
out vec3 cameraViewDirection;

uniform mat4 uModelMatrix;
uniform mat4 uProjectionMatrix;
uniform mat4 uViewMatrix;


void main() {
    mat3 normalMatrix = mat3(transpose(inverse(uModelMatrix)));

    mat4 inverseViewMatrix = inverse(uViewMatrix);
    cameraViewDirection = normalize(vec3(inverseViewMatrix[2]));

    normal = normalize(normalMatrix*vertexNormal);
    textureCoordinates = vertexTextureCoordinates;
    gl_Position = uProjectionMatrix * uViewMatrix * uModelMatrix *  vec4(vertexPosition, 1.0);
}
`,K=n.createShader(n.VERTEX_SHADER);n.shaderSource(K,he),n.compileShader(K);let X=n.createShader(n.FRAGMENT_SHADER);n.shaderSource(X,me),n.compileShader(X);let y=n.createProgram();n.attachShader(y,K),n.attachShader(y,X),n.linkProgram(y),n.useProgram(y);const O={uModelMatrix:n.getUniformLocation(y,"uModelMatrix"),uProjectionMatrix:n.getUniformLocation(y,"uProjectionMatrix"),uViewMatrix:n.getUniformLocation(y,"uViewMatrix"),diffuseTexture:n.getUniformLocation(y,"diffuseTexture"),dirLightDirection:n.getUniformLocation(y,"dirLightDirection"),dirLightColor:n.getUniformLocation(y,"dirLightColor"),dirLightStrength:n.getUniformLocation(y,"dirLightStrength"),lightEnabled:n.getUniformLocation(y,"lightEnabled"),specularEnabled:n.getUniformLocation(y,"specularEnabled")},R={vertexPosition:n.getAttribLocation(y,"vertexPosition"),vertexNormal:n.getAttribLocation(y,"vertexNormal"),vertexTextureCoordinates:n.getAttribLocation(y,"vertexTextureCoordinates")};n.uniform1i(n.getUniformLocation(y,"diffuseTexture"),0);var fe=1e-6,re=typeof Float32Array<"u"?Float32Array:Array;function oe(){var t=new re(16);return re!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function ue(t,e,o){var d=o[0],a=o[1],l=o[2],m,f,u,p,g,w,E,D,v,C,A,I;return e===t?(t[12]=e[0]*d+e[4]*a+e[8]*l+e[12],t[13]=e[1]*d+e[5]*a+e[9]*l+e[13],t[14]=e[2]*d+e[6]*a+e[10]*l+e[14],t[15]=e[3]*d+e[7]*a+e[11]*l+e[15]):(m=e[0],f=e[1],u=e[2],p=e[3],g=e[4],w=e[5],E=e[6],D=e[7],v=e[8],C=e[9],A=e[10],I=e[11],t[0]=m,t[1]=f,t[2]=u,t[3]=p,t[4]=g,t[5]=w,t[6]=E,t[7]=D,t[8]=v,t[9]=C,t[10]=A,t[11]=I,t[12]=m*d+g*a+v*l+e[12],t[13]=f*d+w*a+C*l+e[13],t[14]=u*d+E*a+A*l+e[14],t[15]=p*d+D*a+I*l+e[15]),t}function pe(t,e,o){var d=o[0],a=o[1],l=o[2];return t[0]=e[0]*d,t[1]=e[1]*d,t[2]=e[2]*d,t[3]=e[3]*d,t[4]=e[4]*a,t[5]=e[5]*a,t[6]=e[6]*a,t[7]=e[7]*a,t[8]=e[8]*l,t[9]=e[9]*l,t[10]=e[10]*l,t[11]=e[11]*l,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function J(t,e,o,d){var a=d[0],l=d[1],m=d[2],f=Math.sqrt(a*a+l*l+m*m),u,p,g,w,E,D,v,C,A,I,P,s,r,h,b,N,T,L,U,_,H,z,$,j;return f<fe?null:(f=1/f,a*=f,l*=f,m*=f,u=Math.sin(o),p=Math.cos(o),g=1-p,w=e[0],E=e[1],D=e[2],v=e[3],C=e[4],A=e[5],I=e[6],P=e[7],s=e[8],r=e[9],h=e[10],b=e[11],N=a*a*g+p,T=l*a*g+m*u,L=m*a*g-l*u,U=a*l*g-m*u,_=l*l*g+p,H=m*l*g+a*u,z=a*m*g+l*u,$=l*m*g-a*u,j=m*m*g+p,t[0]=w*N+C*T+s*L,t[1]=E*N+A*T+r*L,t[2]=D*N+I*T+h*L,t[3]=v*N+P*T+b*L,t[4]=w*U+C*_+s*H,t[5]=E*U+A*_+r*H,t[6]=D*U+I*_+h*H,t[7]=v*U+P*_+b*H,t[8]=w*z+C*$+s*j,t[9]=E*z+A*$+r*j,t[10]=D*z+I*$+h*j,t[11]=v*z+P*$+b*j,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function ge(t,e,o,d,a){var l=1/Math.tan(e/2);if(t[0]=l/o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,a!=null&&a!==1/0){var m=1/(d-a);t[10]=(a+d)*m,t[14]=2*a*d*m}else t[10]=-1,t[14]=-2*d;return t}var xe=ge;class ie{position={x:0,y:0,z:0};rotation={x:0,y:0,z:0};scale={x:1,y:1,z:1};getMatrix(){let e=oe();return ue(e,e,[this.position.x,this.position.y,this.position.z]),J(e,e,this.rotation.x,[1,0,0]),J(e,e,this.rotation.y,[0,1,0]),J(e,e,this.rotation.z,[0,0,1]),pe(e,e,[this.scale.x,this.scale.y,this.scale.z]),e}}class M{transform=new ie;model;texture;specularEnabled=!0;lightEnabled=!0;draw(){n.uniform1i(O.lightEnabled,Number(this.lightEnabled)),n.uniform1i(O.specularEnabled,Number(this.specularEnabled)),O.uModelMatrix!=null&&n.uniformMatrix4fv(O.uModelMatrix,!1,this.transform.getMatrix()),this.texture&&(n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,this.texture)),this.model&&this.model.draw()}}const W=8;class Se{vertices=[];arrayBuffer=null;VAO=null;constructor(e){this.VAO=n.createVertexArray(),n.bindVertexArray(this.VAO),this.arrayBuffer=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.arrayBuffer);let o=e.split(",");o.pop(),this.vertices=o.map(Number),n.bufferData(n.ARRAY_BUFFER,new Float32Array(this.vertices),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,this.arrayBuffer),R.vertexPosition!=null&&(n.vertexAttribPointer(R.vertexPosition,3,n.FLOAT,!1,W*4,0),n.enableVertexAttribArray(R.vertexPosition)),R.vertexTextureCoordinates!=null&&(n.vertexAttribPointer(R.vertexTextureCoordinates,2,n.FLOAT,!1,W*4,12),n.enableVertexAttribArray(R.vertexTextureCoordinates)),R.vertexNormal!=null&&(n.vertexAttribPointer(R.vertexNormal,3,n.FLOAT,!1,W*4,20),n.enableVertexAttribArray(R.vertexNormal))}draw(){const e=this.vertices.length/W;n.bindVertexArray(this.VAO),n.bindBuffer(n.ARRAY_BUFFER,this.arrayBuffer),n.drawArrays(n.TRIANGLES,0,e)}}class ye{async loadAssets(e,o){let d={},a={},l={};const m=Object.entries(e);let f=0;const u=m.length;console.log("Fetching assets");for(const[p,g]of m){const w=await fetch(g);if(!w.ok)throw new Error(`Error loading ${g}`);const E=await w.arrayBuffer();switch(g.split(".").pop()?.toLowerCase()){case"model":const v=new TextDecoder("utf-8").decode(E),C=new Se(v);a[p]=C;break;case"png":const A=await this.createTextureFromImage(E);d[p]=A;break;case"mp3":const I=await G.decodeAudioData(E);l[p]=I;break}f++,o(f,u,p)}return{textures:d,models:a,music:l}}createTextureFromImage(e){return new Promise((o,d)=>{const a=new Blob([e]),l=URL.createObjectURL(a),m=new Image;m.onload=()=>{const f=n.createTexture();n.bindTexture(n.TEXTURE_2D,f),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,m),URL.revokeObjectURL(l),n.generateMipmap(n.TEXTURE_2D),o(f)},m.onerror=()=>d(new Error("Promise texture error")),m.src=l})}}let Q=null,V=null;document.addEventListener("click",async()=>{G.state==="suspended"&&await G.resume()});function Z(t){if(!t){console.error("Audio buffer not loaded");return}const e=G.createBufferSource(),o=G.createGain(),d=G.currentTime;e.buffer=t,e.loop=!0,e.connect(o),o.connect(G.destination);let a=6;V&&Q&&(V.gain.cancelScheduledValues(d),V.gain.setValueAtTime(V.gain.value,d),V.gain.linearRampToValueAtTime(0,d+a),Q.stop(d+a)),o.gain.setValueAtTime(0,d),o.gain.linearRampToValueAtTime(1,d+a),e.start(d),V=o,Q=e}class Ee{transform=new ie;#e=70*Math.PI/180;#t=n.canvas.width/n.canvas.height;#n=.1;#r=600;projMatrix=oe();constructor(){this.recreateMatrix()}recreateMatrix(){xe(this.projMatrix,this.#e,this.#t,this.#n,this.#r)}setFov(e){this.#e=e*Math.PI/180,this.recreateMatrix()}}let we={voice1:"Голос 1",in:"",voice2:"Голос 2",ch:"Павел Демидович"},ve=["SAY:voice1:Ты что творишь с моим экспериментом?!","SAY:voice2:Расслабься, никто не заметит...","SAY:voice1:Это неправильно...","SAY:voice2:ЕЩЁ ОДНО СЛОВО — и ты окажешься на его месте.","SAY:voice1:Кх...","SAY:'':(...)","SAY:voice2:Я начинаю!","TOGGLE:::","SCENE:wiresScene","TOGGLE:::","SAY:'':Почему именно я?","TOGGLE:::","WAIT:3000","SCENE:coreScene","TOGGLE:::","SAY:'':Весь мир такой же, как и прежде...","SAY:'':Но теперь я вижу больше.","SAY:'':Я чувствую что оно здесь. В этом лесу.","SAY:'':Я должен избавиться от него.","TOGGLE:::","SCENE:gameScene","TOGGLE:::","SAY:'':Я не успел.","SAY:'':Если бы у меня было хоть какое-то оружие...","SAY:'':Что-то холодное и мерзкое обхватило моё тело.","SAY:'':Сильная боль",`SAY:'':"П-почему я?.."`,"SAY:'':Я больше ничего не чувствую.","SAY:'':...","SAY:'':Спустя некоторое время.","SAY:voice2:Он хорошо себя показал.","SAY:ch:Да, отличный образец.","SAY:ch:Жаль, но нам придётся найти другого.","SAY:voice1:А что нам с ним делать?","SAY:ch:Отправьте куски его тела в «холодильник», мы ещё найдём им применение.","SAY:ch:Только аккуратно.","SAY:voice2:Будет сделано.","TOGGLE:::","SCENE:gameEndScene","TOGGLE:::","SAY:'':Каким же надо было быть дурнем.","SAY:'':Чтобы случайно выпасть из окна три раза.","SAY:'':Больно.",`SAY:'':"П-почему я?.."`,"SAY:'':...","SAY:'':Спустя некоторое время.","SAY:voice2:М-да.","SAY:ch:...кретины.","SAY:ch:Отправьте его в «холодильник».","SAY:ch:И больше не попадайтесь мне на глаза.","SAY:voice2:Есть!","SAY:voice2:(Я ненавижу свою работу)","TOGGLE:::","SCENE:gameEndScene","TOGGLE:::","SAY:'':...","SAY:'':Я смог.","SAY:'':Получилось!","SAY:'':Я изрезал его на кусочки.","SAY:'':Но это ещё не конец.","SAY:'':Я чувствую — они рядом","SAY:'':По крайней мере она будет жить...","TOGGLE:::","SCENE:gameEndScene"],ee=!1,te=!1,ae=!1;function Y(t){ae=t}function Ae(){return ae}function be(t){te=t}function se(t,e){ee=!0;let o=Date.now(),d=e.length*30;de.textContent=we[t],requestAnimationFrame(function a(){let l=(Date.now()-o)/d;te&&(te=!1,l=1),l>=1&&(l=1,ee=!1),le.textContent=e.slice(0,e.length*l),l<1&&requestAnimationFrame(a)})}class k{onAttach=null;onDetach=null;onUpdate=null;onDraw=null;attach(){this.onAttach?.()}update(){this.onUpdate?.()}draw(){this.onDraw?.()}detach(){this.onDetach?.()}}class Te{direction={x:1,y:0,z:0};strength=1;color={r:1,g:1,b:1};draw(){O.dirLightDirection&&n.uniform3f(O.dirLightDirection,this.direction.x,this.direction.y,this.direction.z),O.dirLightColor&&n.uniform3f(O.dirLightColor,this.color.r,this.color.g,this.color.b),O.dirLightStrength&&n.uniform1f(O.dirLightStrength,this.strength)}}const x=Object.freeze({ROUTES:0,LOCATION_INFO:1,LISTENING:2,LOOK:3,FIGHT:4}),B=Object.freeze({NONE:0,WIN:1,DIED:2,STUPID_DEATH:3});class Le{battleDiv;textElement;type=x.LOCATION_INFO;message="";out=B.NONE;locations={forest:{name:"лес",where:`ночь. Я стою в лесу
Сквозь ветки можно увидеть лунный свет`,routes:["facBuilding","lake"],actions:{}},lake:{name:"озеро",where:`я стою у озера
На нём иногда виднеются странные силуэты...`,routes:["forest"],actions:{}},facBuilding:{name:"заброшенный завод",where:`я стою у заброшенного завода
Им уже давно не пользовались...`,routes:["mainHall","forest"],actions:{}},mainHall:{name:"главный коридор",where:`я в главном коридоре
Есть лестница на второй этаж и выход в цех`,routes:["section","floorTwo","facBuilding"],actions:{}},section:{name:"цех",where:`я в цеху
Крышу давно съела ржавчина. Возможно я найду здесь что-нибудь полезное`,routes:["mainHall"],actions:{"взять нож":()=>{delete this.locations.section?.actions["взять нож"],this.type=x.LOCATION_INFO,this.itemHand="knife",this.update()}}},floorTwo:{name:"второй этаж",where:`я на втором этаже
В полу видны огромные дыры и следы присутствия`,routes:["cab","mainHall"],actions:{}},cab:{name:"кабинет директора",where:`я в кабинете директора
Дует холодный ветерок`,routes:["floorTwo"],actions:{"выпрыгнуть в окно":()=>{this.playerHealth-=4,this.type=x.MESSAGE,this.message="Я выпрыгнул в окно. Зачем?",this.currentLocation="facBuilding",this.update()}}}};items={none:{name:"",inHand:"в руке ничего не держу"},knife:{name:"нож",inHand:"в руке я держу нож"}};playerHealth=12;currentLocation="forest";itemHand="none";constructor(){this.battleDiv=document.createElement("div"),this.battleDiv.style.display="flex",this.battleDiv.style.flexDirection="column",this.battleDiv.style.gap="20px",this.battleDiv.classList.add("battle"),this.textElement=document.createElement("span"),this.textElement.textContent="Я нашёл его.",this.textElement.style.fontSize="30px",this.battleDiv.append(this.textElement),F?.append(this.battleDiv),this.update()}getPlayerStatus(){let e="";return this.playerHealth>=10&&(e="чувствую себя хорошо"),this.playerHealth<10&&(e="болят ноги"),this.playerHealth<8&&(e="небольшой перелом..."),this.playerHealth<5&&(e="я истекаю кровью"),this.playerHealth<2&&(e="...п-п-помогите..."),e}getLocationName(){return this.locations[this.currentLocation]?.where??""}getItem(){let e=this.items[this.itemHand]?.inHand??"";return this.itemHand=="none"&&(e=""),e}capitalize(e){return String(e).charAt(0).toUpperCase()+String(e).slice(1)}getLocationInfo(){let e="";return e+=`${this.capitalize(this.getLocationName())}
`,e+=`${this.capitalize(this.getPlayerStatus())}
`,e+=`${this.capitalize(this.getItem())}
`,e}getRoutesInfo(){return"Куда я пойду?"}getRoutesActions(){let e={},o=this.locations[this.currentLocation]?.routes??[];for(let d in o)e[this.capitalize(this.locations[o[d]]?.name)]=()=>{this.currentLocation=o[d],this.type=x.LOCATION_INFO,this.update()};return e.Никуда=()=>{this.type=x.LOCATION_INFO,this.update()},e}update(){if(this.playerHealth<=0){this.out=B.STUPID_DEATH;return}let e="",o;switch(this.type){case x.LOCATION_INFO:e=this.getLocationInfo(),o={},o["переместиться ☇ "]=()=>{this.type=x.ROUTES,this.update()},o["прислушаться ⚟"]=()=>{this.type=x.LISTENING,this.update()},o["осмотреться ⛭"]=()=>{this.type=x.LOOK,this.update()};break;case x.ROUTES:e=this.getRoutesInfo(),o=this.getRoutesActions();break;case x.LISTENING:this.currentLocation=="lake"?(e="Я слышу странные звуки",o={"Подойти ближе":()=>{this.type=x.FIGHT,this.update()},Убежать:()=>{this.currentLocation="forest",this.type=x.LOCATION_INFO,this.update()}}):(e="Я ничего не слышу",o={Хорошо:()=>{this.type=x.LOCATION_INFO,this.update()}});break;case x.LOOK:o=this.locations[this.currentLocation]?.actions??{},o.Ладно=()=>{this.type=x.LOCATION_INFO,this.update()},Object.keys(o).length==1?e="Ничего не нашёл":(e="Что-то есть",o=this.locations[this.currentLocation]?.actions??{});break;case x.MESSAGE:e=this.message,o={Ладно:()=>{this.type=x.LOCATION_INFO,this.update()}},this.message="";break;case x.FIGHT:e=`.@#2П.*
W#@о.5/&о.#ги@т._е/=+_$#
`,o={Убить:()=>{this.itemHand!=="none"?this.out=B.WIN:this.out=B.DIED}};break}let d=F?.getElementsByClassName("action");for(let a=d?.length??0;a>=0;a--)d?.item(a)?.remove();Oe(e,()=>{let a=o;for(let l in a){let m=document.createElement("span");m.classList.add("action"),m.textContent=this.capitalize(l),m.onclick=()=>{(a[l]??(()=>{}))()},this.battleDiv?.append(m)}},this.textElement)}detach(){this.battleDiv.remove()}}function Oe(t,e,o){let d=Date.now(),a=t.length*10;requestAnimationFrame(function l(){let m=(Date.now()-d)/a;m>=1&&(m=1,e()),o.textContent=t.slice(0,t.length*m),m<1&&requestAnimationFrame(l)})}let S={menuScene:null,firstScene:null,wiresScene:null,lepScene:null,coreScene:null,forestScene:null,gameScene:null,deathScene:null,winScene:null,gameEndScene:null,stupidDeathScene:null},i=new Ee,c=new Te;class Me{currentScene=null;ending=B.NONE;initScenes(e,o,d){let a=0,l=-1;const m=()=>{let r=ve[a]?.split(":"),h=r[0];switch(console.log(`[SCENE_MANAGER:DIALOG_TYPE] ${h} ${a}`),h){case"SAY":se(r[1]??"ERROR",r[2]??"UNDEFINED");break;case"TOGGLE":q.classList.toggle("hidden"),se("",""),l=setTimeout(()=>{m()},800);break;case"SCENE":this.setScene(S[r[1]??"menuScene"]),Y(!1);break;case"WAIT":Y(!1),setTimeout(()=>{Y(!0),m()},parseInt(r[1]));break}a+=1};function f(){Ae()&&(ee?be(!0):(l>=0&&(clearTimeout(l),l=-1),m()))}document.addEventListener("click",()=>{f()}),document.addEventListener("keydown",s=>{s.code=="Space"&&f()});const u=new k;u.onAttach=()=>{let s=new M;s.model=o.game_name,s.texture=e.meat;let r=document.createElement("span");r.style.color="white",r.textContent="Click to start",r.style.fontSize="32px",r.style.height="100%",r.style.width="100%",r.style.alignContent="center",r.style.textAlign="center",r.style.display="block",F?.append(r),i.transform.position.z=-2.3,i.transform.position.y=.5,i.setFov(90);let h=0;const b=L=>{this.setScene(S.firstScene)};document.addEventListener("click",b),c.direction.z=.2,c.direction.y=-1,c.direction.x=0,c.color.r=1,c.color.g=0,c.color.b=0,c.strength=.5;const N=L=>{L.key>="0"&&L.key<="9"?T+=L.key:L.key==="Enter"&&(T==="3621"?(T="",console.log("Верный код"),Z(d.delta),this.setScene(S.gameScene)):(console.log(`Неверный код ${T}`),T=""))};let T="";document.addEventListener("keydown",N),u.onUpdate=()=>{i.transform.rotation.y+=Math.sin(h/100)/500,i.transform.rotation.z+=Math.sin(h/100)/1e3,h+=1},u.onDraw=()=>{c.draw(),s.draw()},u.onDetach=()=>{document.removeEventListener("click",b),F?.removeChild(r),document.removeEventListener("keydown",N)}},S.menuScene=u;const p=new k;p.onAttach=()=>{i.transform.rotation.x=0,i.transform.rotation.y=0,i.transform.rotation.z=0,m(),q.classList.toggle("hidden"),Y(!0),p.onUpdate=()=>{},p.onDraw=()=>{},p.onDetach=()=>{}},S.firstScene=p;const g=new k;g.onAttach=()=>{let s=new M;s.model=o.she,s.texture=e.meat;let r=0;Z(d.delta),c.direction.z=.5,c.direction.y=.2,c.direction.x=1,c.color.r=1,c.color.g=0,c.color.b=0,c.strength=1.1,i.transform.rotation.x=.9,i.setFov(49),i.transform.position.z=-36,i.transform.rotation.y=-.5,setTimeout(()=>{this.setScene(S.lepScene)},6e3),g.onDraw=()=>{n.clearColor(1,0,0,1),n.clearDepth(1),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT),c.draw(),s.draw()},g.onUpdate=()=>{i.transform.rotation.x+=Math.sin(r/100)/500,i.transform.position.z+=.01,i.transform.rotation.y+=.001,r+=1}},S.wiresScene=g;const w=new k;w.onAttach=()=>{let s=new M;s.model=o.isee,s.texture=e.meat,i.transform.position.y=-.5,i.transform.position.x=.2,i.transform.rotation.y=1.9,i.transform.rotation.x=-.4,i.transform.position.z=0,i.setFov(60),Y(!0),m(),w.onDraw=()=>{n.clearColor(1,0,0,1),n.clearDepth(1),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT),s.draw()},w.onUpdate=()=>{i.transform.rotation.x>=-.7&&(i.transform.rotation.x-=4e-4)}},S.lepScene=w;const E=new k;E.onAttach=()=>{let s=new M;s.model=o.core,s.texture=e.meat;let r=new M;r.model=o.eyeModel,r.texture=e.eye,i.transform.position.x=0,i.transform.position.y=0,i.transform.position.z=-4,i.transform.rotation.x=0,i.transform.rotation.y=0,i.transform.rotation.z=0,c.color.r=1,c.color.g=.5,c.color.b=.5,c.direction.x=-1,c.direction.z=-.2,c.direction.y=.1,c.strength=0;let h=0;setTimeout(()=>{Y(!0),m(),this.setScene(S.forestScene)},11e3),r.transform.position.z=-.2,E.onUpdate=()=>{i.transform.position.z<-3&&(i.transform.position.z+=.001),c.direction.x+=4e-4,c.direction.z+=4e-4,c.strength+=.002,s.transform.scale.x+=Math.sin(h/10)/1e3,s.transform.scale.y+=Math.sin(h/20)/1e3,r.transform.scale.x+=Math.sin(h/10)/1e3,r.transform.scale.y+=Math.sin(h/20)/1e3,h+=1},E.onDraw=()=>{c.draw(),s.draw(),r.draw()}},S.coreScene=E;const D=new k;D.onAttach=()=>{i.transform.position.x=0,i.transform.position.y=-1,i.transform.position.z=-2,i.transform.rotation.x=-1.2,i.transform.rotation.y=0,i.transform.rotation.z=0,i.setFov(30),c.direction.z=.5,c.direction.y=.2,c.direction.x=.5,c.color.r=.7,c.color.g=.7,c.color.b=.5,c.strength=1.1;let s=new M;s.model=o.tree,s.texture=e.wood,s.specularEnabled=!1;let r=new M;r.model=o.tree,r.texture=e.wood,r.transform.position.z=-2,r.transform.position.x=2,r.specularEnabled=!1;let h=new M;h.model=o.tree,h.texture=e.wood,h.transform.position.z=-3,h.transform.position.x=-2,h.specularEnabled=!1;let b=new M;b.model=o.sky_plane,b.texture=e.clouds,b.transform.position.y=53,b.lightEnabled=!1,b.specularEnabled=!1,D.onDraw=()=>{n.clearColor(.4,.6,.8,1),n.clearDepth(1),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT),c.draw(),s.draw(),r.draw(),h.draw(),b.draw()},D.onUpdate=()=>{i.transform.position.y>-2&&(i.transform.position.y-=.001)}},S.forestScene=D;const v=new k;v.onAttach=()=>{let s=new Le;i.transform.position.x=3,i.transform.position.y=-1,i.transform.position.z=-18,i.transform.rotation.x=.2,i.transform.rotation.y=0,i.transform.rotation.z=0,i.setFov(40),c.direction.z=.01,c.direction.y=-.5,c.direction.x=.1;let r=new M;r.model=o.hum,r.texture=e.meat,r.transform.rotation.x=.9,r.transform.rotation.z=.2,v.onDraw=()=>{switch(s.type){case x.FIGHT:c.color.r=1,c.color.g=.1,c.color.b=.1,c.strength=5,c.draw(),r.draw(),r.transform.rotation.x+=.7,r.transform.rotation.z+=.7,r.transform.rotation.y+=.7,r.draw(),r.transform.rotation.x-=.7,r.transform.rotation.z-=.7,r.transform.rotation.y-=.7;break}};let h=0;v.onUpdate=()=>{switch(s.type){case x.FIGHT:r.transform.scale.x+=Math.sin(h/40)/400,r.transform.scale.z+=Math.sin(h/40)/400,r.transform.scale.y+=Math.cos(h/40)/400,r.transform.rotation.y-=.001}r.transform.rotation.x+=.001,r.transform.rotation.z+=.001,h+=1,s.out==B.DIED&&(this.ending=s.out,this.setScene(S.deathScene)),s.out==B.WIN&&(this.ending=s.out,this.setScene(S.winScene)),s.out==B.STUPID_DEATH&&(this.ending=s.out,console.log("WHY"),this.setScene(S.stupidDeathScene))},v.onDetach=()=>{s.detach()}},S.gameScene=v;const C=new k;C.onAttach=()=>{a=21,Y(!0),m()},S.deathScene=C;const A=new k;A.onAttach=()=>{let s=0,r=new M;r.model=o.triModel,r.texture=e.tri,i.transform.position.x=0,i.transform.position.y=0,i.transform.position.z=-5,i.transform.rotation.x=0,i.transform.rotation.y=0,i.transform.rotation.z=0,c.direction.z=1,c.direction.y=1,c.direction.x=-1,c.strength=3,c.color.r=1,c.color.g=1,c.color.b=1;const h=document.createElement("div");h.classList.add("wavy_text");let b="Спасибо за игру :)",N=[];for(let U of b){let _=document.createElement("span");_.textContent=U,_.classList.add("wavy_char"),h.append(_),N.push(_)}let T=document.createElement("div");T.classList.add("fade_screen"),F?.append(T),setTimeout(()=>{T.classList.add("hidden")},50),F?.append(h),Z(d.screen);let L=document.createElement("span");L.style="position: absolute; top:0; left:0; font-size:15px; color: white",L.textContent=`ENDING ${this.ending}, RELOAD PAGE -> CLICK -> 3621 + ENTER`,document.getElementsByTagName("body")[0].append(L),A.onDraw=()=>{h.style.transform=`translateY(70%) translateX(${Math.sin(s*5)*10}px)`;const U=Math.sin(s/3*Math.PI*2)*.5+.5,_=Math.sin(s/3*Math.PI*2+2*Math.PI/3)*.5+.5,H=Math.sin(s/3*Math.PI*2+4*Math.PI/3)*.5+.5;for(let z=0;z<N.length;z++)N.at(z).style=`color:RGBA(255.0, 255.0, 255.0, 255.0); display: inline-block; transform: translateY(${(Math.sin(z/2+s*10)*.5+.5)*50}px)`;n.clearColor(U,_,H,1),n.clearDepth(1),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT),c.draw(),r.draw()},A.onUpdate=()=>{s+=.008,i.transform.rotation.x-=Math.sin(s/1)/50,i.transform.position.z+=Math.sin(s)/100,r.transform.rotation.x+=Math.sin(s/1)/50,r.transform.rotation.z+=.02,r.transform.rotation.y+=Math.cos(s/1)/50},A.onDetach=()=>{T.remove(),h.remove()}},S.gameEndScene=A;const I=new k;I.onAttach=()=>{a=39,Y(!0),m()},S.stupidDeathScene=I;const P=new k;P.onAttach=()=>{a=54,Y(!0),m(),i.transform.position.x=0,i.transform.position.y=0,i.transform.position.z=-5,i.transform.rotation.x=0,i.transform.rotation.y=0,i.transform.rotation.z=0,console.log(JSON.parse(JSON.stringify(i.transform))),c.direction.z=1,c.direction.y=1,c.direction.x=-1,c.strength=3,c.color.r=1,c.color.g=1,c.color.b=1;let s=new M;s.model=o.sphere,s.texture=e.white,s.transform.scale.x=.1,s.transform.scale.y=.1,s.transform.scale.z=.1,s.transform.position.y=2.5,s.transform.position.x=2;let r=new M;r.model=o.tree,r.texture=e.wood,r.specularEnabled=!1,r.transform.rotation.x=-1.8,r.transform.position.z=5.5,r.transform.position.x=.4;let h=new M;h.model=o.tree,h.texture=e.wood,h.specularEnabled=!1,h.transform.rotation.x=-1.8,h.transform.position.z=5.5,h.transform.position.x=-3,h.transform.position.y=1,P.onDraw=()=>{c.draw(),r.draw(),h.draw(),s.draw()}},S.winScene=P}updateCurrentScene(){this.currentScene&&this.currentScene.update()}drawCurrentScene(){this.currentScene&&this.currentScene.draw()}setScene(e){this.currentScene&&(console.log("[SCENE_MANAGER] Scene detached"),this.currentScene.detach()),this.currentScene=e,this.currentScene.attach()}}performance.now();let De=new ye;const Ce={game_name:"./models/game_name.model",cube:"./models/cube.model",she:"./models/she.model",sphere:"./models/sphere.model",isee:"./models/isee.model",core:"./models/core.model",tree:"./models/tree.model",sky_plane:"./models/sky_plane.model",eyeModel:"./models/eye.model",hum:"./models/hum.model",triModel:"./models/tri.model",placeholder:"./images/placeholder.png",question:"./images/question.png",black:"./images/black.png",white:"./images/white.png",meat:"./images/meat.png",wood:"./images/wood.png",clouds:"./images/clouds.png",eye:"./images/eye.png",tri:"./images/tri.png",screen:"./music/screen.mp3",delta:"./music/delta.mp3"};Ie();async function Ie(){let t=document.createElement("div");t.className="progress",F?.append(t);let e=document.createElement("span");F?.append(e);const{textures:o,models:d,music:a}=await De.loadAssets(Ce,(f,u,p)=>{console.log(`${f}/${u} - ${p}`),F&&(e.textContent=`[FETCHING] ${p} - ${f}/${u}`,t.style.width=`${f/u*100}%`)});e.textContent="[SCENES INIT]";const l=new Me;e.textContent="LEFT CLICK TO START GAME",l.initScenes(o,d,a),document.onclick=()=>{t.remove(),e.remove(),l.setScene(S.menuScene),document.onclick=()=>{}},n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!0),n.enable(n.DEPTH_TEST),n.depthFunc(n.LEQUAL);function m(f){n.clearColor(0,0,0,1),n.clearDepth(1),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT),O.uProjectionMatrix&&n.uniformMatrix4fv(O.uProjectionMatrix,!1,i.projMatrix),O.uViewMatrix&&n.uniformMatrix4fv(O.uViewMatrix,!1,i.transform.getMatrix()),l.updateCurrentScene(),l.drawCurrentScene(),requestAnimationFrame(m)}requestAnimationFrame(m)}})();
